/*! polygoat v0.0.1 2017-05-28 */

var pi2=2*Math.PI;Ease={linear:function(a){return a},cubicIn:function(a){return Math.pow(a,3)},cubicOut:function(a){return 1-Math.pow(1-a,3)},cubicInOut:function(a){return(a*=2)<1?.5*Math.pow(a,3):1-.5*Math.abs(Math.pow(2-a,3))},bounceOut:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},elasticIn:function(a){if(0==a||1==a)return a;var b=.3/pi2*Math.asin(1);return-1*Math.pow(2,10*(a-=1))*Math.sin((a-b)*pi2/.3)},elasticOut:function(a){if(0==a||1==a)return a;var b=.3/pi2*Math.asin(1);return 1*Math.pow(2,-10*a)*Math.sin((a-b)*pi2/.3)+1},elasticInOut:function(a){var b=.3*1.5/pi2*Math.asin(1);return(a*=2)<1?1*Math.pow(2,10*(a-=1))*Math.sin((a-b)*pi2/.3*1.5)*-.5:1*Math.pow(2,-10*(a-=1))*Math.sin((a-b)*pi2/.3*1.5)*.5+1}},paper.Path.inject({getGrowth:function(){var a=this.data._growth;return void 0===a&&(a=1,this.dashArray&&2==this.dashArray.length&&this.dashArray[1]==this.length&&(a=this.dashArray[0]/this.length),this.data._growth=a),a},setGrowth:function(a){this.data._growth=a;var b=a*this.length;this.dashArray=[b,this.length]}}),paper.Item.inject({getRotation:function(){return _.get(this.data,"_rotation",0)},setRotation:function(a,b){this.rotate(a-_.get(this.data,"_rotation",0),b),this.data._rotation=a},attachToPath:function(a,b){this.detachFromPath(a),this.data._master=a,a.data._slaves||(a.data._slaves=[]),a.data._slaves.push(this),this.offsetOnPath=b||0},detachFromPath:function(a){this.data._master&&(this.data._master.data._slaves=_.without(this.data._master.data._slaves,this))},getOffsetOnPath:function(){return this.data._offsetOnPath||0},setOffsetOnPath:function(a){a||(a=0);var b=this.data._master,c=a*b.length;this.position=b.getPointAt(c),this.rotation=b.getNormalAt(c).angle-90,this.data._offsetOnPath=a},flip:function(a){this.scale(-1,1,a)},flop:function(a){this.scale(1,-1,a)}});var animations=[];paper.Item.inject({getFrame:function(){return this.data._frame||(this.data._frame=1),this.data._frame},setFrame:function(a){var b=parseInt(a),c=this.children["f"+(this.data._frame||1)]||this.data._frameLayer,d=this.children["f"+Danimator.limit(b,0,this.frames)]||this.data._frameLayer;void 0===this.data._frame?_.each(this.children,function(a){a.name.match(/^f\d+/g)&&parseInt(a.name.slice(1))!=b&&(a.visible=!1)}):c&&(this.data._frameLayer=c,c.visible=!1),d&&(d.visible=!0),this.data._frame=b,this.data.onFrameChanged&&this.data.onFrameChanged(b)},getFrames:function(){var a=_.map(this.children,function(a){return parseInt(a.name.slice(1))||0});return a.sort(),a.reverse(),a[0]},getState:function(a){return a?this.getItem({match:Danimator.matchBase(a),recursive:!0}).getState():this.data._state||0},setState:function(a,b){var c=this;if(b)return _.each(c.getItems({match:Danimator.matchBase(b),recursive:!0}),function(b){b.setState(a)});var d=c.getStates();return void 0===c.data._state?(c.data._state=_.keys(d)[0],_.each(d,function(a){a.visible=!1})):d[c.data._state].visible=!1,d[a].visible=!0,c.data._state=a,c.data.onStateChanged&&c.data.onStateChanged(a,b),c},getStates:function(){var a=this;return this.data._states||(this.data._states=[],_.each(this.children,function(b){if(b.name.match(/^[#_][a-z0-9_-]+.*$/i)){var c=b.name.match(/^[#_](.*?)(\-\d+)?$/)[1];a.data._states[c]=b,a.data._states.push(b),b.visible=!1}})),this.data._states}}),this.Danimator||(Danimator=function a(){return a.animate.apply(a,arguments)}),Danimator.animate=function(a,b,c,d,e,f){function g(a){var b=this;_.each(b.data._animate,function(a){if(a){var c=((new Date).getTime()-(a.startTime||0))/(1e3*a.duration),d=Danimator.step(a,c),e=Math.abs(a.to-a.from);if(d.done&&(_.pull(b.data._animate,a),b.data._animate.length||(b.off("frame",g),delete b.data._animate),a.options.onDone))if("string"==typeof a.options.onDone)switch("frame"===a.property&&(a.item.data._playing=!0,a.options.delay=1===a.to?0:a.duration/e),a.options.onDone){case"reverse":delete a.options.onDone;case"pingpong":var f=_.clone(a.to);a.to=_.clone(a.from),a.from=f;default:return a.item.data._loops||(a.item.data._loops=0),a.options.onLoop&&a.options.onLoop(a,a.item.data._loops++),Danimator.animate(a.item,a.property,a.from,a.to,a.duration,a.options)}else a.options.onDone&&a.options.onDone(a)}})}var h=animations[a.id]=setTimeout(function(){a.data._animate||(a.data._animate=[],a.on("frame",g));var h="frame"===b?null:"cubicOut",i={item:a,property:b||"opacity",duration:e||1,from:c,to:void 0!==d?d:1,startTime:(new Date).getTime(),options:_.defaults(f,{delay:0,easing:h})};null!==c&&_.set(a,i.property,c),a.data._animate.push(i)},1e3*(f&&f.delay||0));return Danimator.onAnimate&&Danimator.onAnimate(),{options:f,then:Danimator.then,stop:function(){clearTimeout(h)}}},Danimator.then=function(){var a=_.toArray(arguments),b=a.shift(),c=_.last(a);return Danimator._mergeDelays(this.options,c),Danimator[b].apply(this,a)},Danimator._mergeDelays=function(a,b){b.delay=_.get(b,"delay",0)+(a&&a.delay||0)},Danimator.limit=function(a,b,c){if(b>c){var d=b+0;b=c+0,c=d+0,delete d}return Math.max(Math.min(a,c),b)},Danimator.matchBase=function(a){return function(b){return!(!b.name||!b.name.match(new RegExp("^"+a+"([-_]d+)?","i")))}},Danimator.step=function(a,b){var c=_.get(a.item,a.property);void 0==a.from&&(a.from=c),"string"==typeof a.to&&(a.to=a.from+Number(a.to));var d=a.to>a.from,e=a.to-a.from,f=d?c>=a.to:c<=a.to;if(Danimator.interactive&&(f=!1),f)"frame"===a.property&&(a.item.data._playing=!1);else{if(a.options.easing)try{var g="string"==typeof a.options.easing?Ease[a.options.easing]:a.options.easing;g&&(b=g(b))}catch(a){console.warn("Easing helpers not loaded!")}var h=Danimator.limit(a.from+e*b,a.from,a.to);a.options.onStep&&(h=a.options.onStep(h,b,a)),_.set(a.item,a.property,h),paper.project.view.requestUpdate()}return Danimator.onStep&&Danimator.onStep(a,h),{done:f,value:h}},Danimator.fadeIn=function(a,b,c){var d=c&&c.from;return void 0!==d?(a.opacity=d,delete c.from):d=null,a.visible=!0,Danimator(a,"opacity",d,_.get(c,"to",1),b,c)},Danimator.fadeOut=function(a,b,c){var d=c&&c.from;return void 0!==d?(a.opacity=d,delete c.from):d=null,a.visible=!0,Danimator(a,"opacity",d,_.get(c,"to",0),b,c)},Danimator.morph=function(a,b,c,d){var e=[a],f=[b],g=a.clone(),h=[g];"Path"!==a.className&&(e=a.getItems({class:paper.Path}),f=b.getItems({class:paper.Path}),h=g.getItems({class:paper.Path})),a.visible=b.visible=!1,g.name='morph "'+a.name.replace(/(^_|\-\d+$)/g,"")+'" to "'+b.name.replace(/(^_|\-\d+$)/g,"")+'"',g.insertAbove(a),g.data.morphing=0,Danimator.onMorph&&Danimator.onMorph(g,d),Danimator(g,"data.morphing",0,1,c,{onStep:function(c){0===c||1===c?([a,b][c].visible=!0,g.visible=!1):(a.visible=b.visible=!1,g.visible=!0,_.each(e,function(a,b){var d=f[b],e=h[b];_.each(e.segments,function(b,e){var f=a.segments[e],g=d.segments[e];b&&g&&(b.point=f.point.add(g.point.subtract(f.point).multiply(c)),b.handleIn=f.handleIn.add(g.handleIn.subtract(f.handleIn).multiply(c)),b.handleOut=f.handleOut.add(g.handleOut.subtract(f.handleOut).multiply(c)))})}))}})},Danimator.play=function(a,b){var c=a.frames,d=c-a.frame,e=d/(b&&b.fps||12);return a.data._playing=!0,b.frameDuration=e/d,Danimator(a,"frame",a.frame,c,e,b)},Danimator.stop=function(a){a.data._playing=!1},Danimator.stopAll=function(a){_.each(animations[a.id],function(a,b){clearTimeout(a),delete animations[b]}),delete a.data._animate},Danimator.load=function(a){var b=a+".animations.json";$.getJSON(b,null,function(a,c){"success"===c?(_.each(a,function(a,b){isNaN(Number(b))||(b=Number(b)),a.item=GAME.find(b)}),tracks=_.extend(tracks,a),_createTracks()):console.warn('Animations "'+b+"\" couldn't be loaded :(")}).fail(function(a,b,c){console.error(c)})},Danimator.sound=function(a,b){var c=_.extend({name:a,src:["audio/"+a]},b),d=_.get(Danimator.sounds,a),e=0,f=0;return c.src=_.map(c.src,function(b){return b.match(/^\/?audio\/.+$/g)||(b="audio/"+b),b.match(/.*\.[^\.]+$/g)?b:(a+=".m4a",b+".m4a")}),c.fadeIn&&(e=c.fadeIn,delete c.fadeIn),c.fadeOut&&(f=c.fadeOut,delete c.fadeOut),d||(d=Danimator.sounds[a]={source:new Howl(c),get:function(a){return this.source["_"+a]},set:function(a,b){this.source[a](b,this.instance)},play:function(){return this.stopped=!1,Danimator._activeSound=this,this.instance=this.source.play()},stop:function(){this.source.stop(this.instance),this.stopped=!0,Danimator.onSoundStop&&Danimator.onSoundStop(this)},fadeIn:function(a){var b=this.source.volume(null,this.instance);return this.source.fade(0,b,a,this.instance),b},fadeOut:function(a){var b=this.source.volume(null,this.instance);return this.source.fade(b,0,a,this.instance),b}}),d.lastOptions=b,setTimeout(function(){Danimator.interactive?Danimator._activeSound=d:(d.play(),e&&d.fadeIn(e),f&&d.fadeOut(f)),Danimator.onSound&&Danimator.onSound(a,b)},_.get(b,"delay",0)),d},Danimator.sounds={},Danimator.interactive=!1,Danimator.startTime=(new Date).getTime(),Game=function(a,b,c,d){var e=this;return e.name=b,e.type=c.type,e.file="games/"+e.type+"/"+b+".svg",e.project=a,e.options=c||{},e.symbols=[],e.resize=function(a){},e.reset=function(){this.dragging=!1},e._resolveFiles=function(a){var b={};switch(typeof a){case"object":return _.isArray(a)?_.merge.apply(_,_.map(a,e._resolveFiles)):a;case"string":var c=a.match(/\.([^\.]{2,5})$/g);if(c)return b[c[0].slice(1)]=a,b;if(a.match(/<svg.*>/g))return{svg:a};if(a.match(/\n/g))return{js:a}}return!1},e.load=function(f){(f=e._resolveFiles(f))&&(f.svg&&(a.clear(),a.view.update(),a.importSVG(f.svg,{expandShapes:!0,onLoad:function(g,h){e.container=g,e.scene=e.container.children;try{e.DOM=$(h)}catch(a){}_.each(a.symbolDefinitions,function(a){a.item.name&&(e.symbols[a.item.name]=a)}),e.scene.UI&&_.each(e.scene.UI.children,function(a){a.visible=!1}),e.resize({size:a.view.viewSize}),g.position=a.view.center;try{d&&d(e.scene,e.container,e),Game.onLoad&&Game.onLoad.call(e,a,b,c),console.log("%c SVG loaded ","background-color:#444; color:#CCC",f.svg)}catch(a){console.error("Game could not be properly initialized. %c "+a+" ","background-color:red; color: #fff;")}}})),f.js&&(console.log("files.js",f.js),jQuery.ajax({url:f.js,dataType:"script",success:function(){console.log("success! arguments",arguments)},async:!0})))},e.load(e.file),this};
//# sourceMappingURL=Danimator.min.js.map